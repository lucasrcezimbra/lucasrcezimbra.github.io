<!doctype html><html lang=pt><head><title>ChatGPT - Decimal approximation in Python ¬∑ Lucas Cezimbra</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Lucas Cezimbra"><meta name=description content="
  Lucas
  
    
    Link to heading
  

In [1]: from decimal import Decimal

In [2]: Decimal(0.1)
Out[2]: Decimal('0.1000000000000000055511151231257827021181583404541015625')

In [3]: Decimal('0.1')
Out[3]: Decimal('0.1')
Why it happens?

  ChatGPT
  
    
    Link to heading
  

The reason for this behavior is related to how floating-point numbers are represented in computers.
In computers, floating-point numbers are represented in binary format using a fixed number of bits. However, some decimal numbers that have a finite number of decimal places, such as 0.1, cannot be represented exactly in binary format using a finite number of bits. Instead, they can only be approximated using a sequence of binary digits."><meta name=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cezimbra.me/images/lucas-180x180.jpg"><meta name=twitter:title content="ChatGPT - Decimal approximation in Python"><meta name=twitter:description content="Lucas Link to heading In [1]: from decimal import Decimal In [2]: Decimal(0.1) Out[2]: Decimal('0.1000000000000000055511151231257827021181583404541015625') In [3]: Decimal('0.1') Out[3]: Decimal('0.1') Why it happens?
ChatGPT Link to heading The reason for this behavior is related to how floating-point numbers are represented in computers.
In computers, floating-point numbers are represented in binary format using a fixed number of bits. However, some decimal numbers that have a finite number of decimal places, such as 0.1, cannot be represented exactly in binary format using a finite number of bits. Instead, they can only be approximated using a sequence of binary digits."><meta property="og:url" content="https://cezimbra.me/anotacoes/chatgpt---decimal-approximation-in-python/"><meta property="og:site_name" content="Lucas Cezimbra"><meta property="og:title" content="ChatGPT - Decimal approximation in Python"><meta property="og:description" content="Lucas Link to heading In [1]: from decimal import Decimal In [2]: Decimal(0.1) Out[2]: Decimal('0.1000000000000000055511151231257827021181583404541015625') In [3]: Decimal('0.1') Out[3]: Decimal('0.1') Why it happens?
ChatGPT Link to heading The reason for this behavior is related to how floating-point numbers are represented in computers.
In computers, floating-point numbers are represented in binary format using a fixed number of bits. However, some decimal numbers that have a finite number of decimal places, such as 0.1, cannot be represented exactly in binary format using a finite number of bits. Instead, they can only be approximated using a sequence of binary digits."><meta property="og:locale" content="pt"><meta property="og:type" content="article"><meta property="article:section" content="anotacoes"><meta property="article:published_time" content="2023-08-15T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-15T00:00:00+00:00"><meta property="og:image" content="https://cezimbra.me/images/lucas-180x180.jpg"><link rel=canonical href=https://cezimbra.me/anotacoes/chatgpt---decimal-approximation-in-python/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.7ee04855f01a7f7a311ce189708f520a1a1d93c249cfed3b23e8c27666fc546e.css integrity="sha256-fuBIVfAaf3oxHOGJcI9SChodk8JJz+07I+jCdmb8VG4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/contribution.min.cc4187dd6677d15a0c4438b74294dbe3f54269e14a831b267fb6f02a24f90d5d.css integrity="sha256-zEGH3WZ30VoMRDi3QpTb4/VCaeFKgxsmf7bwKiT5DV0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/custom.min.2ef373c2c125094d9302d8a924eba231d053340611b63bcf581460745cef626f.css integrity="sha256-LvNzwsElCU2TAtipJOuiMdBTNAYRtjvPWBRgdFzvYm8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/jquery.dataTables.min.min.3b0b9d00b1890ba1fb1472480998b073ad910d4c2a73f5d48fda7c43c21c0b75.css integrity="sha256-OwudALGJC6H7FHJICZiwc62RDUwqc/XUj9p8Q8IcC3U=" crossorigin=anonymous media=screen><link rel=stylesheet href=/project.min.cc15fca9f603b853c828be903488d99afe86c71e40721cc4927e27f7453a4a36.css integrity="sha256-zBX8qfYDuFPIKL6QNIjZmv6Gxx5AchzEkn4n90U6SjY=" crossorigin=anonymous media=screen><link rel=stylesheet href=/timeline.min.801628785543d9e7f6deb109e9561a48da7823522c0986a7dd47be117447e62f.css integrity="sha256-gBYoeFVD2ef23rEJ6VYaSNp4I1IsCYan3Ue+EXRH5i8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/vis-timeline-graph2d.min.min.fdf246c52f0424d937fb4fcb748533abfff41e7872e80c53c6e2c0f5cfa91410.css integrity="sha256-/fJGxS8EJNk3+0/LdIUzq//0Hnhy6AxTxuLA9c+pFBA=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/lucas-32x32.jpg sizes=32x32><link rel=icon type=image/png href=/images/lucas-16x16.jpg sizes=16x16><link rel=apple-touch-icon href=/images/lucas-180x180.jpg><link rel=apple-touch-icon sizes=180x180 href=/images/lucas-180x180.jpg><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body hx-boost=true class="preload-transitions colorscheme-dark"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://cezimbra.me/>Lucas Cezimbra
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/sobre/>Sobre</a></li><li class=navigation-item><a class=navigation-link href=/projetos/>Projetos</a></li><li class=navigation-item><a class=navigation-link href=/anotacoes/indice/>Anota√ß√µes</a></li><li class=navigation-item><a class=navigation-link href=/palestras/>Palestras</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://toolbox.cezimbra.me/>Toolbox ‚Üó</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/en/>üá∫üá∏</a></li></ul></section></nav><div class=content><section class="container page"><article><header><h1 class=title><a class=title-link href=https://cezimbra.me/anotacoes/chatgpt---decimal-approximation-in-python/>ChatGPT - Decimal approximation in Python</a></h1></header><h2 id=lucas>Lucas
<a class=heading-link href=#lucas><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>In [<span style=color:#cd00cd>1</span>]: <span style=color:#cd00cd>from</span> decimal <span style=color:#cd00cd>import</span> Decimal
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>In [<span style=color:#cd00cd>2</span>]: Decimal(<span style=color:#cd00cd>0.1</span>)
</span></span><span style=display:flex><span>Out[<span style=color:#cd00cd>2</span>]: Decimal(<span style=color:#cd0000>&#39;0.1000000000000000055511151231257827021181583404541015625&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>In [<span style=color:#cd00cd>3</span>]: Decimal(<span style=color:#cd0000>&#39;0.1&#39;</span>)
</span></span><span style=display:flex><span>Out[<span style=color:#cd00cd>3</span>]: Decimal(<span style=color:#cd0000>&#39;0.1&#39;</span>)
</span></span></code></pre></div><p>Why it happens?</p><h2 id=chatgpt>ChatGPT
<a class=heading-link href=#chatgpt><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The reason for this behavior is related to how floating-point numbers are represented in computers.</p><p>In computers, floating-point numbers are represented in binary format using a fixed number of bits. However, some decimal numbers that have a finite number of decimal places, such as 0.1, cannot be represented exactly in binary format using a finite number of bits. Instead, they can only be approximated using a sequence of binary digits.</p><p>When you create a <code>Decimal</code> object from the float <code>0.1</code>, the float is first converted to its binary representation, which is an approximation of the decimal value. This approximation is then converted to a <code>Decimal</code> object, which retains the approximation. When you create a <code>Decimal</code> object from the string <code>'0.1'</code>, the string is directly converted to the <code>Decimal</code> object, without any binary-to-decimal conversion.</p><p>So, the reason for the different output values in your example is that <code>Decimal(0.1)</code> is created from a binary approximation of the decimal number 0.1, while <code>Decimal('0.1')</code> is created directly from the string representation of the decimal number 0.1, which is exact.</p><h2 id=lucas-1>Lucas
<a class=heading-link href=#lucas-1><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Why Python Decimal does it? Why does it not cast to string when creating to Decimal?</p><h2 id=chatgpt-1>ChatGPT
<a class=heading-link href=#chatgpt-1><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>1 / 2</p><p>Python&rsquo;s <code>Decimal</code> module was designed to provide exact decimal arithmetic in Python, which is important in many applications, such as financial and monetary calculations. When creating a <code>Decimal</code> object from a float, Python&rsquo;s <code>Decimal</code> module tries to provide an exact representation of the original decimal value, rather than the binary approximation that a float represents.</p><p>However, this can lead to unexpected results, as shown in your example. To avoid such situations, it&rsquo;s recommended to always create <code>Decimal</code> objects from strings, which ensures that the exact decimal value is used to create the <code>Decimal</code> object.</p><p>Regarding why Python&rsquo;s <code>Decimal</code> module does not cast to string automatically when creating a <code>Decimal</code> object from a float, it&rsquo;s likely due to performance considerations. Converting a float to a string and then creating a <code>Decimal</code> object from the string can be slower than creating a <code>Decimal</code> object directly from the float. Additionally, the binary approximation of a float may be close enough to the original decimal value in many cases, so it makes sense to allow users to choose whether to convert to string or not, based on their specific needs.</p><h2 id=lucas-2>Lucas
<a class=heading-link href=#lucas-2><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Does Python have a PEP about this topic?</p><h2 id=chatgpt-2>ChatGPT
<a class=heading-link href=#chatgpt-2><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Yes, Python does have a PEP (Python Enhancement Proposal) about this topic. PEP 327, titled &ldquo;Decimal Data Type&rdquo;, introduced the <code>decimal</code> module to Python and specified the behavior of the <code>Decimal</code> class. This PEP provides detailed information about the motivation behind the <code>decimal</code> module, its design, and its implementation.</p><p>In particular, the PEP specifies that creating a <code>Decimal</code> object from a float is allowed, but the result is not guaranteed to be exact. This is because, as I explained earlier, floating-point numbers can only approximate some decimal values. The PEP also recommends creating <code>Decimal</code> objects from strings instead of floats, to ensure exact decimal representation.</p><p>If you are interested in learning more about the <code>decimal</code> module and its design, I would recommend reading PEP 327. It provides a comprehensive overview of the module and its intended behavior.</p><h2 id=lucas-3>Lucas
<a class=heading-link href=#lucas-3><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Give me the link</p><h2 id=chatgpt-3>ChatGPT
<a class=heading-link href=#chatgpt-3><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Sure, here is the link to PEP 327 on the official Python website:</p><p><a href=https://www.python.org/dev/peps/pep-0327/ class=external-link target=_blank rel=noopener>https://www.python.org/dev/peps/pep-0327/</a></p><p>The PEP provides detailed information about the motivation behind the <code>decimal</code> module, its design, and its implementation. It also includes examples and explanations of how to use the module, as well as a discussion of its limitations and known issues.</p><h2 id=lucas-4>Lucas
<a class=heading-link href=#lucas-4><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Based on the PEP, why does it not cast the float to string when creating a Decimal?</p><h2 id=chatgpt-4>ChatGPT
<a class=heading-link href=#chatgpt-4><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>1 / 2</p><p>PEP 327 does not explicitly state why the <code>Decimal</code> constructor does not cast a float to a string when creating a <code>Decimal</code> object. However, one possible reason for this is performance.</p><p>Converting a float to a string requires significant computation, especially for large or complex floats. Creating a <code>Decimal</code> object from a float without first converting it to a string can be faster, especially if the float has a small number of significant digits. In addition, the binary representation of a float is sometimes sufficient for certain calculations, so it may make sense to allow users to choose between creating a <code>Decimal</code> object from a float directly or by converting it to a string first.</p><p>Furthermore, the <code>Decimal</code> constructor allows for other types of input, such as integers and tuples, which cannot be directly cast to a string. Allowing for direct input of various types without requiring string conversion adds flexibility and convenience to the <code>Decimal</code> class.</p><p>Overall, while creating a <code>Decimal</code> object from a string is recommended for precision and consistency, allowing direct input of floats and other types without string conversion can be useful in certain situations and is consistent with the design of the <code>Decimal</code> module.</p><h2 id=lucas-5>Lucas
<a class=heading-link href=#lucas-5><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>From float</p><p>The initial discussion on this item was what should happen when passing floating point to the constructor:</p><pre><code>Decimal(1.1) == Decimal('1.1')
Decimal(1.1) == Decimal('110000000000000008881784197001252...e-51')
an exception is raised
</code></pre><p>Several people alleged that (1) is the better option here, because it‚Äôs what you expect when writing Decimal(1.1). And quoting John Roth, it‚Äôs easy to implement:</p><pre><code>It‚Äôs not at all difficult to find where the actual number ends and where the fuzz begins. You can do it visually, and the algorithms to do it are quite well known.
</code></pre><p>But If I really want my number to be Decimal(&lsquo;110000000000000008881784197001252&mldr;e-51&rsquo;), why can‚Äôt I write Decimal(1.1)? Why should I expect Decimal to be ‚Äúrounding‚Äù it? Remember that 1.1 is binary floating point, so I can predict the result. It‚Äôs not intuitive to a beginner, but that‚Äôs the way it is.</p><p>Anyway, Paul Moore showed that (1) can‚Äôt work, because:</p><p>(1) says D(1.1) == D(&lsquo;1.1&rsquo;)
but 1.1 == 1.1000000000000001
so D(1.1) == D(1.1000000000000001)
together: D(1.1000000000000001) == D(&lsquo;1.1&rsquo;)</p><p>which is wrong, because if I write Decimal(&lsquo;1.1&rsquo;) it is exact, not D(1.1000000000000001). He also proposed to have an explicit conversion to float. bokr says you need to put the precision in the constructor and mwilson agreed:</p><p>d = Decimal (1.1, 1) # take float value to 1 decimal place
d = Decimal (1.1) # gets <code>places</code> from pre-set context</p><p>But Alex Martelli says that:</p><pre><code>Constructing with some specified precision would be fine. Thus, I think ‚Äúconstruction from float with some default precision‚Äù runs a substantial risk of tricking naive users.
</code></pre><p>So, the accepted solution through c.l.p is that you can not call Decimal with a float. Instead you must use a method: Decimal.from_float(). The syntax:</p><p>Decimal.from_float(floatNumber, [decimal_places])</p><p>where floatNumber is the float number origin of the construction and decimal_places are the number of digits after the decimal point where you apply a round-half-up rounding, if any. In this way you can do, for example:</p><p>Decimal.from_float(1.1, 2): The same as doing Decimal(&lsquo;1.1&rsquo;).
Decimal.from_float(1.1, 16): The same as doing Decimal(&lsquo;1.1000000000000001&rsquo;).
Decimal.from_float(1.1): The same as doing Decimal(&lsquo;1100000000000000088817841970012523233890533447265625e-51&rsquo;).</p><p>Based on later discussions, it was decided to omit from_float() from the API for Py2.4. Several ideas contributed to the thought process:</p><pre><code>Interactions between decimal and binary floating point force the user to deal with tricky issues of representation and round-off. Avoidance of those issues is a primary reason for having the module in the first place.
The first release of the module should focus on that which is safe, minimal, and essential.
While theoretically nice, real world use cases for interactions between floats and decimals are lacking. Java included float/decimal conversions to handle an obscure case where calculations are best performed in decimal even though a legacy data structure requires the inputs and outputs to be stored in binary floating point.
If the need arises, users can use string representations as an intermediate type. The advantage of this approach is that it makes explicit the assumptions about precision and representation (no wondering what is going on under the hood).
The Java docs for BigDecimal(double val) reflected their experiences with the constructor:

The results of this constructor can be somewhat
unpredictable and its use is generally not recommended.
</code></pre><h2 id=chatgpt-5>ChatGPT
<a class=heading-link href=#chatgpt-5><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>2 / 2</p><p>According to the PEP, the decision not to cast the float to a string when creating a Decimal was made because of the risk of tricking naive users. Constructing with some specified precision was considered fine, but construction from a float with some default precision was believed to run a substantial risk of tricking naive users. Additionally, interactions between decimal and binary floating point force the user to deal with tricky issues of representation and round-off, which is a primary reason for having the module in the first place. In summary, it was decided that users can use string representations as an intermediate type if the need arises.</p><h2 id=lucas-6>Lucas
<a class=heading-link href=#lucas-6><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>How should I instantiate Decimal to avoid floating point errors?</p><h2 id=chatgpt-6>ChatGPT
<a class=heading-link href=#chatgpt-6><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>You should instantiate Decimal with a string argument, rather than a floating-point number. This ensures that the decimal representation of the number is exact, without any loss of precision due to the limitations of floating-point arithmetic.</p><p>For example, instead of using <code>Decimal(0.1)</code>, you should use <code>Decimal('0.1')</code>. Here is an example code snippet:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#cd00cd>from</span> decimal <span style=color:#cd00cd>import</span> Decimal
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:navy># Using a string to instantiate Decimal to avoid floating point errors</span>
</span></span><span style=display:flex><span>x <span style=color:#39c>=</span> Decimal(<span style=color:#cd0000>&#39;0.1&#39;</span>)
</span></span><span style=display:flex><span>y <span style=color:#39c>=</span> Decimal(<span style=color:#cd0000>&#39;0.2&#39;</span>)
</span></span><span style=display:flex><span>z <span style=color:#39c>=</span> x <span style=color:#39c>+</span> y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cd00cd>print</span>(z)  <span style=color:navy># Output: 0.3</span>
</span></span></code></pre></div><p>In this example, we create Decimal instances using string literals to ensure that the precision of the numbers is preserved, and then we perform arithmetic operations without any floating-point errors.</p><h2 id=lucas-7>Lucas
<a class=heading-link href=#lucas-7><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>What if I have a float variable?</p><h2 id=chatgpt-7>ChatGPT
<a class=heading-link href=#chatgpt-7><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>2 / 2</p><p>If you have a float variable, you can pass it to the <code>Decimal</code> constructor as a string to ensure accuracy:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>x <span style=color:#39c>=</span> <span style=color:#cd00cd>0.1</span>
</span></span><span style=display:flex><span>dec_x <span style=color:#39c>=</span> Decimal(<span style=color:#cd00cd>str</span>(x))
</span></span></code></pre></div><p>Alternatively, you can use the <code>from_float</code> method:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>x <span style=color:#39c>=</span> <span style=color:#cd00cd>0.1</span>
</span></span><span style=display:flex><span>dec_x <span style=color:#39c>=</span> Decimal<span style=color:#39c>.</span>from_float(x)
</span></span></code></pre></div><p>Note that the <code>from_float</code> method takes an optional argument <code>context</code> which you can use to specify the precision and rounding mode to use. If you don&rsquo;t specify the <code>context</code>, it uses the current global context, which you can set using the <code>getcontext()</code> function.</p><h2 id=lucas-8>Lucas
<a class=heading-link href=#lucas-8><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>How does this context work? How can I set a context?</p><h2 id=chatgpt-8>ChatGPT
<a class=heading-link href=#chatgpt-8><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The decimal module provides a way to control the precision, rounding, and other settings for decimal calculations through a context object. You can create a context object using the <code>Context()</code> constructor:</p><p>python</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#cd00cd>from</span> decimal <span style=color:#cd00cd>import</span> Context
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ctx <span style=color:#39c>=</span> Context(prec<span style=color:#39c>=</span><span style=color:#cd00cd>28</span>, rounding<span style=color:#39c>=</span><span style=color:#cd0000>&#39;ROUND_HALF_UP&#39;</span>)
</span></span></code></pre></div><p>The <code>prec</code> parameter sets the precision for the context, i.e., the number of digits that should be used for the mantissa of the Decimal number. The <code>rounding</code> parameter sets the rounding mode to be used for the context. There are several rounding modes available, such as <code>ROUND_HALF_UP</code>, <code>ROUND_HALF_EVEN</code>, <code>ROUND_UP</code>, <code>ROUND_DOWN</code>, <code>ROUND_CEILING</code>, and <code>ROUND_FLOOR</code>.</p><p>Once you have created a context object, you can use it in your Decimal calculations by passing it as an argument to the Decimal constructor:</p><p>python</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#cd00cd>from</span> decimal <span style=color:#cd00cd>import</span> Decimal, Context
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ctx <span style=color:#39c>=</span> Context(prec<span style=color:#39c>=</span><span style=color:#cd00cd>28</span>, rounding<span style=color:#39c>=</span><span style=color:#cd0000>&#39;ROUND_HALF_UP&#39;</span>)
</span></span><span style=display:flex><span>x <span style=color:#39c>=</span> Decimal(<span style=color:#cd00cd>0.1</span>, context<span style=color:#39c>=</span>ctx)
</span></span><span style=display:flex><span>y <span style=color:#39c>=</span> Decimal(<span style=color:#cd00cd>0.2</span>, context<span style=color:#39c>=</span>ctx)
</span></span><span style=display:flex><span>z <span style=color:#39c>=</span> x <span style=color:#39c>+</span> y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cd00cd>print</span>(z)
</span></span></code></pre></div><p>This will output:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Decimal(<span style=color:#cd0000>&#39;0.3000000000000000166533453694&#39;</span>)
</span></span></code></pre></div><p>Note that the context object is only used for the Decimal calculations that use it explicitly. If you create a Decimal without passing a context object, it will use the default context, which has a precision of 28 and uses the <code>ROUND_HALF_EVEN</code> rounding mode.</p><p>You can also set a global context that will be used by all Decimal operations by calling the <code>getcontext()</code> function and modifying the properties of the returned context object:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#cd00cd>from</span> decimal <span style=color:#cd00cd>import</span> getcontext, Decimal
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>getcontext()<span style=color:#39c>.</span>prec <span style=color:#39c>=</span> <span style=color:#cd00cd>28</span>
</span></span><span style=display:flex><span>getcontext()<span style=color:#39c>.</span>rounding <span style=color:#39c>=</span> <span style=color:#cd0000>&#39;ROUND_HALF_UP&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>x <span style=color:#39c>=</span> Decimal(<span style=color:#cd00cd>0.1</span>)
</span></span><span style=display:flex><span>y <span style=color:#39c>=</span> Decimal(<span style=color:#cd00cd>0.2</span>)
</span></span><span style=display:flex><span>z <span style=color:#39c>=</span> x <span style=color:#39c>+</span> y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cd00cd>print</span>(z)
</span></span></code></pre></div><p>This will output the same result as before:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Decimal(<span style=color:#cd0000>&#39;0.3000000000000000166533453694&#39;</span>)
</span></span></code></pre></div><p>Keep in mind that modifying the global context can affect other parts of your code that use Decimal, so use it with caution. It&rsquo;s generally better to use a local context for each calculation to avoid unexpected behavior.</p><h2 id=lucas-9>Lucas
<a class=heading-link href=#lucas-9><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>In [<span style=color:#cd00cd>14</span>]: Decimal<span style=color:#39c>.</span>from_float(<span style=color:#cd00cd>0.1</span>, Context(prec<span style=color:#39c>=</span><span style=color:#cd00cd>1</span>))
</span></span><span style=display:flex><span><span style=color:#39c>---------------------------------------------------------------------------</span>
</span></span><span style=display:flex><span><span style=color:#669;font-weight:700>TypeError</span>                                 Traceback (most recent call last)
</span></span><span style=display:flex><span>Cell In[<span style=color:#cd00cd>14</span>], line <span style=color:#cd00cd>1</span>
</span></span><span style=display:flex><span><span style=color:#39c>----&gt;</span> <span style=color:#cd00cd>1</span> Decimal<span style=color:#39c>.</span>from_float(<span style=color:#cd00cd>0.1</span>, Context(prec<span style=color:#39c>=</span><span style=color:#cd00cd>1</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#669;font-weight:700>TypeError</span>: Decimal<span style=color:#39c>.</span>from_float() takes exactly one argument (<span style=color:#cd00cd>2</span> given)
</span></span></code></pre></div><h2 id=chatgpt-9>ChatGPT
<a class=heading-link href=#chatgpt-9><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The <code>Decimal.from_float()</code> method does not accept a <code>Context</code> object as an argument. Instead, you should create a new <code>Decimal</code> context, set the precision you want, and then use it to create the <code>Decimal</code> object:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#39c>&gt;&gt;&gt;</span> <span style=color:#cd00cd>from</span> decimal <span style=color:#cd00cd>import</span> <span style=color:#39c>*</span>
</span></span><span style=display:flex><span><span style=color:#39c>&gt;&gt;&gt;</span> getcontext()<span style=color:#39c>.</span>prec <span style=color:#39c>=</span> <span style=color:#cd00cd>1</span>  <span style=color:navy># set global context precision to 1</span>
</span></span><span style=display:flex><span><span style=color:#39c>&gt;&gt;&gt;</span> Decimal<span style=color:#39c>.</span>from_float(<span style=color:#cd00cd>0.1</span>)
</span></span><span style=display:flex><span>Decimal(<span style=color:#cd0000>&#39;0.1&#39;</span>)
</span></span></code></pre></div><p>In this example, we set the global context precision to 1 using the <code>getcontext().prec</code> attribute. This means that all <code>Decimal</code> objects created in the current context will have a precision of 1, unless otherwise specified. Then, we use the <code>Decimal.from_float()</code> method to create a new <code>Decimal</code> object from a float value of 0.1, which is rounded to 1 decimal place according to the current context precision. The result is <code>Decimal('0.1')</code>.</p><h2 id=lucas-10>Lucas
<a class=heading-link href=#lucas-10><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>In [<span style=color:#cd00cd>20</span>]: <span style=color:navy>#from decimal import *</span>
</span></span><span style=display:flex><span>    <span style=color:#39c>...</span>: getcontext()<span style=color:#39c>.</span>prec <span style=color:#39c>=</span> <span style=color:#cd00cd>1</span>  <span style=color:navy># set global context precision to 1</span>
</span></span><span style=display:flex><span>    <span style=color:#39c>...</span>: Decimal<span style=color:#39c>.</span>from_float(<span style=color:#cd00cd>0.1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Out[<span style=color:#cd00cd>20</span>]: Decimal(<span style=color:#cd0000>&#39;0.1000000000000000055511151231257827021181583404541015625&#39;</span>)
</span></span></code></pre></div><h2 id=chatgpt-10>ChatGPT
<a class=heading-link href=#chatgpt-10><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>In the code snippet you provided, the global precision of the decimal context is set to 1 with the line <code>getcontext().prec = 1</code>. This means that any Decimal number created after this point will have a precision of 1 (i.e. will only have one digit after the decimal point).</p><p>Then, <code>Decimal.from_float(0.1)</code> is called, which creates a Decimal number from the float value 0.1. However, since the global context precision is set to 1, the resulting Decimal number is rounded to have only one digit after the decimal point, resulting in <code>Decimal('0.1')</code>.</p><p>Note that this behavior only applies to Decimal numbers created after the global context precision is set to 1. If you create a Decimal number with a higher precision context, the precision will be preserved, even if you subsequently change the global context precision.</p><h2 id=lucas-11>Lucas
<a class=heading-link href=#lucas-11><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>It didn&rsquo;t work.</p><h2 id=chatgpt-11>ChatGPT
<a class=heading-link href=#chatgpt-11><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>I apologize for the confusion. It seems that the context settings were not applied correctly.</p><p>Here&rsquo;s an example of how to correctly set the context and use <code>Decimal.from_float()</code> to avoid floating-point errors:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#cd00cd>from</span> decimal <span style=color:#cd00cd>import</span> <span style=color:#39c>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:navy># create a new context with precision set to 1</span>
</span></span><span style=display:flex><span>ctx <span style=color:#39c>=</span> Context(prec<span style=color:#39c>=</span><span style=color:#cd00cd>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:navy># set the current global context to the new context</span>
</span></span><span style=display:flex><span>setcontext(ctx)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:navy># use Decimal.from_float() with the current global context</span>
</span></span><span style=display:flex><span>result <span style=color:#39c>=</span> Decimal<span style=color:#39c>.</span>from_float(<span style=color:#cd00cd>0.1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:navy># print the result</span>
</span></span><span style=display:flex><span><span style=color:#cd00cd>print</span>(result)
</span></span></code></pre></div><p>This should output <code>0.1</code>, which is the expected result when using a context with a precision of 1.</p><p>Please note that the context is set globally, so any subsequent Decimal operations will also use this context. If you want to reset the context to the default values, you can use <code>getcontext().prec = None</code>.</p></article></section></div><footer class=footer><section class=container>¬©
2025
Lucas Cezimbra
¬∑
<a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script><script src=/js/htmx.min.c4fce4dc5cc9c8c3c9bf1aa788d54bb2cb25cd27114eb06551494ff61c30d6fb.js integrity="sha256-xPzk3FzJyMPJvxqniNVLssslzScRTrBlUUlP9hww1vs="></script><script src=/jquery-3.6.1.min.min.8985a8985a8bab0c06c0f4036f1a7dcb928dc0822c1d50517a1c6538f25c87db.js integrity="sha256-iYWomFqLqwwGwPQDbxp9y5KNwIIsHVBRehxlOPJch9s="></script><script src=/jquery.dataTables.min.min.16697a3bc9cb9058c116bec9c264c212029776d1292883bfbb44570a207e15a2.js integrity="sha256-Fml6O8nLkFjBFr7JwmTCEgKXdtEpKIO/u0RXCiB+FaI="></script><script src=/vis-timeline-graph2d.min.min.5557a35c7d0b9814c91ae2bad7d55f94f9451fe3e783252e212d5fe7eeaa8400.js integrity="sha256-VVejXH0LmBTJGuK619VflPlFH+PngyUuIS1f5+6qhAA="></script><script data-goatcounter=https://cezimbra.goatcounter.com/count async src=//gc.zgo.at/count.js></script></body></html>