<!doctype html><html lang=pt><head><title>ast-grep by example Â· Lucas Cezimbra
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Lucas Cezimbra"><meta name=description content="
ast-grep


  Add a new argument to all self methods
  
    
    Link to heading
  

id: new-args-to-all-methods
language: python
rule:
    kind: parameters
    pattern: $$$ARGS
transform:
  INNER_ARGS:
    substring:
        source: $ARGS
        startChar: 1
        endChar: -1
  NEW_INNER_ARGS:
    replace:
      replace: 'self,?'
      by: 'self, <new_arg1>, <new_arg2>,'
      source: $INNER_ARGS
fix: '($NEW_INNER_ARGS)'
 def func1():
     ...

 def func2(args):
     ...

 class MyClass:
-    def method1(self):
+    def method1(self, <new_arg1>, <new_arg2>,):
         ...

-    def method2(self, args):
+    def method2(self, <new_arg1>, <new_arg2>, args):
         ...

     @classmethod
     def cls_method(cls):
         ...

     @staticmethod
     def static_method(cls):
         ...

  Alias import and replace identifiers
  
    
    Link to heading
  

id: replace-non-import-identifiers
language: python
rule:
    kind: identifier
    pattern: 'MyIdentifier'
    not:
      inside:
          kind: dotted_name
          inside:
              kind: import_from_statement
fix: 'MyNewIdentifier'
---
id: alias-import
language: python
rule:
    pattern: 'MyIdentifier'
    kind: identifier
    inside:
        kind: dotted_name
        inside:
            pattern: 'from x import $$$'
            kind: import_from_statement
fix: 'MyIdentifier as MyNewIdentifier'
-from x import MyIdentifier
+from x import MyIdentifier as MyNewIdentifier

-MyIdentifier.ABC
+MyNewIdentifier.ABC

 s = 'The MyIdentifier inside strings will not be changed.'

  Append to the body of a function
  
    
    Link to heading
  

id: append-to-function-body
language: python
rule:
    pattern: 'def user($$$ARGS): $$$BODY'
fix: |
    def user($$$ARGS):
        $$$BODY
        yield
        tear_down()
 @pytest.fixture
 def user():
     create_user()
+    yield
+    tear_down()

  Change function calls
  
    
    Link to heading
  

id: change-function-calls
language: python
rule:
    pattern: 'my_func'
    kind: identifier
    inside:
        kind: call
fix: 'my_new_func'
 from x import my_func

 my_func.X = ''
 s = 'my_func inside string will not be changed'

-my_func()
+my_new_func()
"><meta name=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cezimbra.me/images/lucas-180x180.jpg"><meta name=twitter:title content="ast-grep by example"><meta name=twitter:description content="ast-grep Add a new argument to all self methods Link to heading id: new-args-to-all-methods language: python rule: kind: parameters pattern: $$$ARGS transform: INNER_ARGS: substring: source: $ARGS startChar: 1 endChar: -1 NEW_INNER_ARGS: replace: replace: 'self,?' by: 'self, <new_arg1>, <new_arg2>,' source: $INNER_ARGS fix: '($NEW_INNER_ARGS)' def func1(): ... def func2(args): ... class MyClass: - def method1(self): + def method1(self, <new_arg1>, <new_arg2>,): ... - def method2(self, args): + def method2(self, <new_arg1>, <new_arg2>, args): ... @classmethod def cls_method(cls): ... @staticmethod def static_method(cls): ... Alias import and replace identifiers Link to heading id: replace-non-import-identifiers language: python rule: kind: identifier pattern: 'MyIdentifier' not: inside: kind: dotted_name inside: kind: import_from_statement fix: 'MyNewIdentifier' --- id: alias-import language: python rule: pattern: 'MyIdentifier' kind: identifier inside: kind: dotted_name inside: pattern: 'from x import $$$' kind: import_from_statement fix: 'MyIdentifier as MyNewIdentifier' -from x import MyIdentifier +from x import MyIdentifier as MyNewIdentifier -MyIdentifier.ABC +MyNewIdentifier.ABC s = 'The MyIdentifier inside strings will not be changed.' Append to the body of a function Link to heading id: append-to-function-body language: python rule: pattern: 'def user($$$ARGS): $$$BODY' fix: | def user($$$ARGS): $$$BODY yield tear_down() @pytest.fixture def user(): create_user() + yield + tear_down() Change function calls Link to heading id: change-function-calls language: python rule: pattern: 'my_func' kind: identifier inside: kind: call fix: 'my_new_func' from x import my_func my_func.X = '' s = 'my_func inside string will not be changed' -my_func() +my_new_func()"><meta property="og:url" content="https://cezimbra.me/anotacoes/ast-grep-by-example/"><meta property="og:site_name" content="Lucas Cezimbra"><meta property="og:title" content="ast-grep by example"><meta property="og:description" content="ast-grep Add a new argument to all self methods Link to heading id: new-args-to-all-methods language: python rule: kind: parameters pattern: $$$ARGS transform: INNER_ARGS: substring: source: $ARGS startChar: 1 endChar: -1 NEW_INNER_ARGS: replace: replace: 'self,?' by: 'self, <new_arg1>, <new_arg2>,' source: $INNER_ARGS fix: '($NEW_INNER_ARGS)' def func1(): ... def func2(args): ... class MyClass: - def method1(self): + def method1(self, <new_arg1>, <new_arg2>,): ... - def method2(self, args): + def method2(self, <new_arg1>, <new_arg2>, args): ... @classmethod def cls_method(cls): ... @staticmethod def static_method(cls): ... Alias import and replace identifiers Link to heading id: replace-non-import-identifiers language: python rule: kind: identifier pattern: 'MyIdentifier' not: inside: kind: dotted_name inside: kind: import_from_statement fix: 'MyNewIdentifier' --- id: alias-import language: python rule: pattern: 'MyIdentifier' kind: identifier inside: kind: dotted_name inside: pattern: 'from x import $$$' kind: import_from_statement fix: 'MyIdentifier as MyNewIdentifier' -from x import MyIdentifier +from x import MyIdentifier as MyNewIdentifier -MyIdentifier.ABC +MyNewIdentifier.ABC s = 'The MyIdentifier inside strings will not be changed.' Append to the body of a function Link to heading id: append-to-function-body language: python rule: pattern: 'def user($$$ARGS): $$$BODY' fix: | def user($$$ARGS): $$$BODY yield tear_down() @pytest.fixture def user(): create_user() + yield + tear_down() Change function calls Link to heading id: change-function-calls language: python rule: pattern: 'my_func' kind: identifier inside: kind: call fix: 'my_new_func' from x import my_func my_func.X = '' s = 'my_func inside string will not be changed' -my_func() +my_new_func()"><meta property="og:locale" content="pt"><meta property="og:type" content="article"><meta property="article:section" content="anotacoes"><meta property="article:published_time" content="2024-09-30T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-02T00:00:00+00:00"><meta property="og:image" content="https://cezimbra.me/images/lucas-180x180.jpg"><link rel=canonical href=https://cezimbra.me/anotacoes/ast-grep-by-example/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.7763f8bc6341ecf82378e867c285e1549abb063a899be313ccd25dbfcd24fa7d.css integrity="sha256-d2P4vGNB7PgjeOhnwoXhVJq7BjqJm+MTzNJdv80k+n0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/contribution.min.cc4187dd6677d15a0c4438b74294dbe3f54269e14a831b267fb6f02a24f90d5d.css integrity="sha256-zEGH3WZ30VoMRDi3QpTb4/VCaeFKgxsmf7bwKiT5DV0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/custom.min.2ef373c2c125094d9302d8a924eba231d053340611b63bcf581460745cef626f.css integrity="sha256-LvNzwsElCU2TAtipJOuiMdBTNAYRtjvPWBRgdFzvYm8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/jquery.dataTables.min.min.8f6eae843117db9532d2c9b910f3b28834d22d85107ce9aba8b5abbeab67400a.css integrity="sha256-j26uhDEX25Uy0sm5EPOyiDTSLYUQfOmrqLWrvqtnQAo=" crossorigin=anonymous media=screen><link rel=stylesheet href=/project.min.cc15fca9f603b853c828be903488d99afe86c71e40721cc4927e27f7453a4a36.css integrity="sha256-zBX8qfYDuFPIKL6QNIjZmv6Gxx5AchzEkn4n90U6SjY=" crossorigin=anonymous media=screen><link rel=stylesheet href=/timeline.min.801628785543d9e7f6deb109e9561a48da7823522c0986a7dd47be117447e62f.css integrity="sha256-gBYoeFVD2ef23rEJ6VYaSNp4I1IsCYan3Ue+EXRH5i8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/vis-timeline-graph2d.min.min.15aad78c7961c518a27d54923d04eea2b750b66ebea8f490d9fe599da0ae8928.css integrity="sha256-FarXjHlhxRiifVSSPQTuordQtm6+qPSQ2f5ZnaCuiSg=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/lucas-32x32.jpg sizes=32x32><link rel=icon type=image/png href=/images/lucas-16x16.jpg sizes=16x16><link rel=apple-touch-icon href=/images/lucas-180x180.jpg><link rel=apple-touch-icon sizes=180x180 href=/images/lucas-180x180.jpg><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body hx-boost=true class="preload-transitions colorscheme-dark"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://cezimbra.me/>Lucas Cezimbra
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/sobre/>Sobre</a></li><li class=navigation-item><a class=navigation-link href=/projetos/>Projetos</a></li><li class=navigation-item><a class=navigation-link href=/anotacoes/indice/>AnotaÃ§Ãµes</a></li><li class=navigation-item><a class=navigation-link href=/palestras/>Palestras</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://toolbox.cezimbra.me/>Toolbox â†—</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/en/>ðŸ‡ºðŸ‡¸</a></li></ul></section></nav><div class=content><section class="container page"><article><header><h1 class=title><a class=title-link href=https://cezimbra.me/anotacoes/ast-grep-by-example/>ast-grep by example</a></h1></header><ul><li><a href=https://github.com/ast-grep/ast-grep class=external-link target=_blank rel=noopener>ast-grep</a></li></ul><h2 id=add-a-new-argument-to-all-self-methods>Add a new argument to all self methods
<a class=heading-link href=#add-a-new-argument-to-all-self-methods><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>id: new-args-to-all-methods
</span></span><span style=display:flex><span>language: python
</span></span><span style=display:flex><span>rule:
</span></span><span style=display:flex><span>    kind: parameters
</span></span><span style=display:flex><span>    pattern: $$$ARGS
</span></span><span style=display:flex><span>transform:
</span></span><span style=display:flex><span>  INNER_ARGS:
</span></span><span style=display:flex><span>    substring:
</span></span><span style=display:flex><span>        source: $ARGS
</span></span><span style=display:flex><span>        startChar: <span style=color:#cd00cd>1</span>
</span></span><span style=display:flex><span>        endChar: -<span style=color:#cd00cd>1</span>
</span></span><span style=display:flex><span>  NEW_INNER_ARGS:
</span></span><span style=display:flex><span>    replace:
</span></span><span style=display:flex><span>      replace: <span style=color:#cd0000>&#39;self,?&#39;</span>
</span></span><span style=display:flex><span>      by: <span style=color:#cd0000>&#39;self, &lt;new_arg1&gt;, &lt;new_arg2&gt;,&#39;</span>
</span></span><span style=display:flex><span>      source: $INNER_ARGS
</span></span><span style=display:flex><span>fix: <span style=color:#cd0000>&#39;($NEW_INNER_ARGS)&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span> def func1():
</span></span><span style=display:flex><span>     ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> def func2(args):
</span></span><span style=display:flex><span>     ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> class MyClass:
</span></span><span style=display:flex><span><span style=color:#cd0000>-    def method1(self):
</span></span></span><span style=display:flex><span><span style=color:#cd0000></span><span style=color:#00cd00>+    def method1(self, &lt;new_arg1&gt;, &lt;new_arg2&gt;,):
</span></span></span><span style=display:flex><span><span style=color:#00cd00></span>         ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cd0000>-    def method2(self, args):
</span></span></span><span style=display:flex><span><span style=color:#cd0000></span><span style=color:#00cd00>+    def method2(self, &lt;new_arg1&gt;, &lt;new_arg2&gt;, args):
</span></span></span><span style=display:flex><span><span style=color:#00cd00></span>         ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     @classmethod
</span></span><span style=display:flex><span>     def cls_method(cls):
</span></span><span style=display:flex><span>         ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     @staticmethod
</span></span><span style=display:flex><span>     def static_method(cls):
</span></span><span style=display:flex><span>         ...
</span></span></code></pre></div><h2 id=alias-import-and-replace-identifiers>Alias import and replace identifiers
<a class=heading-link href=#alias-import-and-replace-identifiers><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>id: replace-non-import-identifiers
</span></span><span style=display:flex><span>language: python
</span></span><span style=display:flex><span>rule:
</span></span><span style=display:flex><span>    kind: identifier
</span></span><span style=display:flex><span>    pattern: <span style=color:#cd0000>&#39;MyIdentifier&#39;</span>
</span></span><span style=display:flex><span>    not:
</span></span><span style=display:flex><span>      inside:
</span></span><span style=display:flex><span>          kind: dotted_name
</span></span><span style=display:flex><span>          inside:
</span></span><span style=display:flex><span>              kind: import_from_statement
</span></span><span style=display:flex><span>fix: <span style=color:#cd0000>&#39;MyNewIdentifier&#39;</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>id: alias-import
</span></span><span style=display:flex><span>language: python
</span></span><span style=display:flex><span>rule:
</span></span><span style=display:flex><span>    pattern: <span style=color:#cd0000>&#39;MyIdentifier&#39;</span>
</span></span><span style=display:flex><span>    kind: identifier
</span></span><span style=display:flex><span>    inside:
</span></span><span style=display:flex><span>        kind: dotted_name
</span></span><span style=display:flex><span>        inside:
</span></span><span style=display:flex><span>            pattern: <span style=color:#cd0000>&#39;from x import $$$&#39;</span>
</span></span><span style=display:flex><span>            kind: import_from_statement
</span></span><span style=display:flex><span>fix: <span style=color:#cd0000>&#39;MyIdentifier as MyNewIdentifier&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#cd0000>-from x import MyIdentifier
</span></span></span><span style=display:flex><span><span style=color:#cd0000></span><span style=color:#00cd00>+from x import MyIdentifier as MyNewIdentifier
</span></span></span><span style=display:flex><span><span style=color:#00cd00></span>
</span></span><span style=display:flex><span><span style=color:#cd0000>-MyIdentifier.ABC
</span></span></span><span style=display:flex><span><span style=color:#cd0000></span><span style=color:#00cd00>+MyNewIdentifier.ABC
</span></span></span><span style=display:flex><span><span style=color:#00cd00></span>
</span></span><span style=display:flex><span> s = &#39;The MyIdentifier inside strings will not be changed.&#39;
</span></span></code></pre></div><h2 id=append-to-the-body-of-a-function>Append to the body of a function
<a class=heading-link href=#append-to-the-body-of-a-function><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>id: append-to-function-body
</span></span><span style=display:flex><span>language: python
</span></span><span style=display:flex><span>rule:
</span></span><span style=display:flex><span>    pattern: &#39;def user($$$ARGS): $$$BODY&#39;
</span></span><span style=display:flex><span>fix: |<span style=color:#cd0000>
</span></span></span><span style=display:flex><span><span style=color:#cd0000>    def user($$$ARGS):
</span></span></span><span style=display:flex><span><span style=color:#cd0000>        $$$BODY
</span></span></span><span style=display:flex><span><span style=color:#cd0000>        yield
</span></span></span><span style=display:flex><span><span style=color:#cd0000>        tear_down()</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span> @pytest.fixture
</span></span><span style=display:flex><span> def user():
</span></span><span style=display:flex><span>     create_user()
</span></span><span style=display:flex><span><span style=color:#00cd00>+    yield
</span></span></span><span style=display:flex><span><span style=color:#00cd00>+    tear_down()
</span></span></span></code></pre></div><h2 id=change-function-calls>Change function calls
<a class=heading-link href=#change-function-calls><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>id: change-function-calls
</span></span><span style=display:flex><span>language: python
</span></span><span style=display:flex><span>rule:
</span></span><span style=display:flex><span>    pattern: <span style=color:#cd0000>&#39;my_func&#39;</span>
</span></span><span style=display:flex><span>    kind: identifier
</span></span><span style=display:flex><span>    inside:
</span></span><span style=display:flex><span>        kind: call
</span></span><span style=display:flex><span>fix: <span style=color:#cd0000>&#39;my_new_func&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span> from x import my_func
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> my_func.X = &#39;&#39;
</span></span><span style=display:flex><span> s = &#39;my_func inside string will not be changed&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cd0000>-my_func()
</span></span></span><span style=display:flex><span><span style=color:#cd0000></span><span style=color:#00cd00>+my_new_func()
</span></span></span></code></pre></div></article></section></div><footer class=footer><section class=container>Â©
2025
Lucas Cezimbra
Â·
<a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script><script src=/js/htmx.min.c4fce4dc5cc9c8c3c9bf1aa788d54bb2cb25cd27114eb06551494ff61c30d6fb.js integrity="sha256-xPzk3FzJyMPJvxqniNVLssslzScRTrBlUUlP9hww1vs="></script><script src=/jquery-3.6.1.min.min.4833b7f001f63606fe402ea689716ace9d2a681e77e9396cda239bef25214def.js integrity="sha256-SDO38AH2Ngb+QC6miXFqzp0qaB536Tls2iOb7yUhTe8="></script><script src=/jquery.dataTables.min.min.81d3bc71314508a0b97e678aad65ff0b3312dcac9a1a7332273aba32a4802ae4.js integrity="sha256-gdO8cTFFCKC5fmeKrWX/CzMS3KyaGnMyJzq6MqSAKuQ="></script><script src=/vis-timeline-graph2d.min.min.6875120b8974a16fa91b554c25e30ff7e5eab67c5535cfa323f41d2cd6b9f802.js integrity="sha256-aHUSC4l0oW+pG1VMJeMP9+XqtnxVNc+jI/QdLNa5+AI="></script><script data-goatcounter=https://cezimbra.goatcounter.com/count async src=//gc.zgo.at/count.js></script></body></html>